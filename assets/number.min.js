jQuery.noConflict();(function($){
    $(function(){
        
       
        // переменные
        var winW=window.innerWidth;
        var winH=window.innerHeight;
        var timeOut;
        var header=$('#header');
        var scrollPos=0;
        var screenBtn;
        var currentURL=window.location.href.slice(18);
        var textShare=$('title').text();
        var transformDelta=50;
        var transformLimit;
        var dashboardTop=$('#dashboard').offset().top;
        var outputOpen=0;
        var appendContentHeight,discardContentHeight,insertContentHeight=0;
        var startScroll=0;
        var detailsHeight=document.querySelector('#details-content p').offsetHeight+20;
        var loadLibrary=0;
        var submitDelay=0;
        var funcManualHeight;

        
        // первая или последующие загрузки
        // +++
        localStorage.setItem('visited','second');

        
        // определение высоты funcManual
        // +++
        $('#func-manual').css({opacity:0,transform:'translate3d(0,-100%,0) scale3d(1,1,1)'});funcManualHeight=parseInt($('#func-manual').css('height'));$('#func-manual').css({transform:'translate3d(0,-100%,0) scale3d(1,0,1)',opacity:1});
        
        
        // очистка стилей после reload-preload
        // +++
        if(winW<480){
            timeOut=750;
        }else{
            timeOut=1500;
        };
        setTimeout(function(){
            $('#reload').css('display','none').removeClass('entry-page');
            $('#background').removeClass('no-transition');
        },timeOut);
        
        
        // уход в начало страницы при загрузке
        // +++
        //window.scroll({top:0,left:0,behavior:'smooth'});        
        
        
        // выбор темы + вывод уведомления + смена темы
        // +++
        $('#white,#white-double,#black,#black-double').on('click',function(){
            let currentTheme=localStorage.getItem('theme');
            let clickBtn=$(this);
            if(currentTheme=='white'){
                if($(clickBtn).is('#white-double')){
                }else if($(clickBtn).is('#black-double')){
                    localStorage.setItem('theme','black');
                    $('body').addClass('black');
                    $('#setting-close').click();
                };    
            }else if(currentTheme=='black'){
                if($(clickBtn).is('#white-double')){
                    localStorage.setItem('theme','white');
                    $('body').removeClass('black');
                    $('#setting-close').click();
                }else if($(clickBtn).is('#black-double')){
                };
            }else{
                if($(clickBtn).is('#white')){
                    localStorage.setItem('theme','white');
                    $('body').removeClass('black');
                    $('#preload').addClass('preload-out');
                    setTimeout(function(){
                        enableScroll();
                    },210);
                }else if($(clickBtn).is('#black')){
                    localStorage.setItem('theme','black');
                    $('body').addClass('black');
                    $('#preload').addClass('contr-black preload-out');
                    setTimeout(function(){
                        $('#preload').removeClass('contr-black');
                        enableScroll();
                    },210);
                };
            };
        });  


        // установка иконок из спрайта и доп шрифта
        // +++
        $('head').append('<style>.fully{background-image:url(/assets/fully.svg);}#smally{background-image:url(/assets/smally.webp);}.mobile #logo,#nav-open::before,#social-open::before,#setting-open::before,summary::before,#details-close::before,#nav-close::before,#social-close::before,#setting-close::before,#link-close::before,#tg-btn,#wa-btn,#vk-btn,#vb-btn,#ok-btn,.txt-up::after,.txt-down::after,#scroll-top::after,#scroll-bottom::after,#shuffle-generate::before,#copy-generate::before,#save-xls::before,#save-generate::before,#link-generate::before,#print-generate::before,#panel::before,#panel::after,#arrow,#more::before,#more::after,#review-close::before,#feedback-close::before{background-image:url(/assets/sprite.webp);}.aside-decor::before{content:url(/assets/fully.svg);}@font-face{font-family:segoe;src:url("/assets/segoe.woff2") format("woff2");font-display:swap;}</style>');

        
        // мобильная панель
        // +++
        if($('body').is('.mobile')){
            $('#panel').on('click',function(){
                $('#panel').addClass('panel-close');
                setTimeout(function(){
                    $('#header').removeClass('header-hidden');
                    $('#blured').fadeIn(200);
                },200);
            });
            $(document).on('click',function(e){
                if(!$('#header').is('.header-hidden')){
                    if((!header.is(e.target))&&(header.has(e.target).length===0)){
                        $('#header').addClass('header-hidden');
                        $('#blured').fadeOut(200);
                        setTimeout(function(){
                            $('#panel').removeClass('panel-close');
                        },200);
                    };
                };
            });
        };
        
        
        // nav: открытие + закрытие
        // +++
        $('#nav-open').on('click',function(){
            disableScroll();
            $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(50px,0,0)');
            if(!$('body').is('.mobile')){
                $('#logo').fadeOut(200);
            };            
            setTimeout(function(){
                $('nav,#background').css('transform','scale3d(1,1,1)');
                $('main,aside,footer').css('transform','scale3d(0,1,1)');
                $('#nav-close').addClass('close-visible');
            },200);
            setTimeout(function(){
                if($('body').is('.mobile')){$('#blured').css('display','none');};
                //$('#blured').fadeOut(200);
                $('#nav-close').css('transform','scale3d(1,1,1) rotate(0)').removeClass('close-visible');
            },1200);
        });
        $('#nav-close').on('click',function(){
            $('#nav-close').addClass('close-hidden');
            setTimeout(function(){
                $('nav,#background').css('transform','scale3d(0,1,1)');
                $('main,aside,footer').css('transform','scale3d(1,1,1)');
                if($('body').is('.mobile')){
                    $('#header').addClass('header-hidden');
                };
            },300);
            setTimeout(function(){
                if($('body').is('.mobile')){
                    $('#panel').removeClass('panel-close');
                }else{
                    $('#logo').fadeIn(200);
                };
                $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(0,0,0)');
                $('#nav-close').css('transform','scale3d(0,0,1) rotate(0)').removeClass('close-hidden');
                enableScroll();
            },600);
        });


        // social: открытие + функционал + закрытие
        // +++
        $('#social-open').on('click',function(){
            disableScroll();
            $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(50px,0,0)');
            if(!$('body').is('.mobile')){
                $('#logo').fadeOut(200);
            };
            setTimeout(function(){
                $('#social-menu,#background').css('transform','scale3d(1,1,1)');
                $('main,aside,footer').css('transform','scale3d(0,1,1)');
                $('#social-close').addClass('close-visible');
            },200);
            setTimeout(function(){
                if($('body').is('.mobile')){$('#blured').css('display','none');};
                $('#social-close').css('transform','scale3d(1,1,1) rotate(0)').removeClass('close-visible');
            },1200);
        });
        $('#tg-btn').on('click',function(){window.open('https://telegram.me/share/url?url='+currentURL+'&text='+textShare+'&utm_source=share2','_blank');});$('#wa-btn').on('click',function(){window.open('https://api.whatsapp.com/send? text='+textShare+' '+currentURL+'','_blank');});$('#vk-btn').on('click',function(){window.open('https://vkontakte.ru/share.php?url='+currentURL+'','_blank');});$('#vb-btn').on('click',function(){window.open('viber://forward?text= '+textShare+' '+currentURL+'','_blank');});$('#ok-btn').on('click',function(){window.open('https://connect.ok.ru/offer?url='+currentURL+'','_blank');});
        $('#social-close').on('click',function(){
            $('#social-close').addClass('close-hidden');
            setTimeout(function(){
                $('#social-menu,#background').css('transform','scale3d(0,1,1)');
                $('main,aside,footer').css('transform','scale3d(1,1,1)');
                if($('body').is('.mobile')){
                    $('#header').addClass('header-hidden');
                };
            },300);
            setTimeout(function(){
                if($('body').is('.mobile')){
                    $('#panel').removeClass('panel-close');
                }else{
                    $('#logo').fadeIn(200);
                };
                $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(0,0,0)');
                $('#social-close').css('transform','scale3d(0,0,1) rotate(0)').removeClass('close-hidden');
                enableScroll();
            },600);
        });
        
        
        // setting: открытие + закрытие
        // +++
        $('#setting-open').on('click',function(){
            disableScroll();
            $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(50px,0,0)');
            if(!$('body').is('.mobile')){
                $('#logo').fadeOut(200);
            };
            setTimeout(function(){
                $('#setting-menu,#background').css('transform','scale3d(1,1,1)');
                $('main,aside,footer').css('transform','scale3d(0,1,1)');
                $('#setting-close').addClass('close-visible');
            },200);
            setTimeout(function(){
                if($('body').is('.mobile')){$('#blured').css('display','none');};
                $('#setting-close').css('transform','scale3d(1,1,1) rotate(0)').removeClass('close-visible');
            },1200);
        });
        $('#setting-close').on('click',function(){
            $('#setting-close').addClass('close-hidden');
            setTimeout(function(){
                $('#setting-menu,#background').css('transform','scale3d(0,1,1)');
                $('main,aside,footer').css('transform','scale3d(1,1,1)');
                if($('body').is('.mobile')){
                    $('#header').addClass('header-hidden');
                };
            },300);
            setTimeout(function(){
                if($('body').is('.mobile')){
                    $('#panel').removeClass('panel-close');
                }else{
                    $('#logo').fadeIn(200);
                };
                $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(0,0,0)');
                $('#setting-close').css('transform','scale3d(0,0,1) rotate(0)').removeClass('close-hidden');
                enableScroll();
            },600);
        });
        
        
        // details: открытие + закрытие + scrolling
        // +++
        $('summary,#summary-duplicate').on('click',function(e){
            e.preventDefault();
            disableScroll();
            /*$('#reload').css('display','block').addClass('exit-page');
            setTimeout(function(){
                window.location.reload();
            },timeOut);*/
            $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(50px,0,0)');
            if(!$('body').is('.mobile')){
                $('#logo').fadeOut(200);
            };
            if(($('body').is('.mobile'))&&($(this).is('#summary-duplicate'))){
                $('#panel').addClass('panel-close');
                setTimeout(function(){
                    $('#header').removeClass('header-hidden');
                 },200);
            };
            $('details').css('width','100vw').prop('open',true);
            setTimeout(function(){
                $('summary').css('display','none');
                $('#details-content,#background').css('transform','scale3d(1,1,1)');
                $('main,aside,footer').css('transform','scale3d(0,1,1)');
                $('#details-close').addClass('close-visible');
                transformLimit=parseInt($('#details-box').height())-parseInt($('#scroll-box').height());
            },200);
            setTimeout(function(){
                if($('body').is('.mobile')){$('#blured').css('display','none');};
                $('#details-close').css('transform','scale3d(1,1,1) rotate(0)').removeClass('close-visible');
            },1200);
        });
        $('#details-close').on('click',function(){
            $('#details-close').addClass('close-hidden');
            setTimeout(function(){
                $('#details-content,#background').css('transform','scale3d(0,1,1)');
                $('main,aside,footer').css('transform','scale3d(1,1,1)');
                $('summary').css('display','block');
                if($('body').is('.mobile')){
                    $('#header').addClass('header-hidden');
                };
            },300);
            setTimeout(function(){
                if($('body').is('.mobile')){
                    $('#panel').removeClass('panel-close');
                }else{
                    $('#logo').fadeIn(200);
                };
                $('details').css('width','0').prop('open',false);
                $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(0,0,0)');
                $('#details-close').css('transform','scale3d(0,0,1) rotate(0)').removeClass('close-hidden');
                enableScroll();
            },600);
        });
        $('#scroll-top').on('click',function(){
            let transformPos=transformDelta*Math.ceil(parseInt($('#scroll-box').css('transform').match(/-?[\d\.]+/g)[5])/transformDelta);
            if(transformPos<-transformDelta){    
                $('#scroll-box').css('transform','translate3d(0,'+(transformDelta*Math.ceil((transformPos+transformDelta)/transformDelta))+'px,0)');
                $('#scroll-top').fadeIn(200);
            }else{
                $('#scroll-box').css('transform','translate3d(0,0,0)');
                $('#scroll-top').fadeOut(200);
            };
            $('#scroll-bottom').fadeIn(200);
        });
        $('#scroll-bottom').on('click',function(){
            let transformPos=transformDelta*Math.ceil(parseInt($('#scroll-box').css('transform').match(/-?[\d\.]+/g)[5])/transformDelta);
            if((transformPos<=0)&&(transformPos>=transformLimit+transformDelta)){    
                $('#scroll-box').css('transform','translate3d(0,'+(transformDelta*Math.ceil((transformPos-transformDelta)/transformDelta))+'px,0)');
                $('#scroll-bottom').fadeIn(200);
            }else{
                $('#scroll-box').css('transform','translate3d(0,'+transformLimit+'px,0)');
                $('#scroll-bottom').fadeOut(200);
            };
            $('#scroll-top').fadeIn(200);
        });
        
        
        // открытие title-text
        // -
        let textHeight=$('#title p').height();
        let textContainerHeight=$('#title-text').height();
        $('#more').on('click',function(){
            if($('#more').is('.more-opening')){
                $('#title-text').css('height',textHeight+40+'px');
            }else{
                $('#title-text').css('height',textContainerHeight+'px');
            };
            $('#more').toggleClass('more-opening more-closed');
        });
        
        
        // смена текстовки заголовка генерации
        // +++
        let countInput=$('#count');
        $(countInput).on('input',function(){
            let countValue=$(countInput).val();
            if(countValue==1){
                $('.keyword').html(' слу&shy;чай&shy;но&shy;го чис&shy;ла');
            }else if(countValue>1){
                $('.keyword').html(' слу&shy;чай&shy;ных чи&shy;сел');
            };
        });
        
        
        // выбор типа генерации
        // +++
        $('label[for="span-btn"]').on('click',function(){
            $('#span-label').addClass('active-tab').removeClass('deactive-tab');
            $('#tab-1').addClass('visible-tab');
            $('#list-label').removeClass('active-tab').addClass('deactive-tab');
            $('#tab-2').removeClass('visible-tab');
            $('#output').addClass('span').removeClass('list');
            submitValidate();
        });
        $('label[for="list-btn"]').on('click',function(){
            $('#list-label').addClass('active-tab').removeClass('deactive-tab');
            $('#tab-2').addClass('visible-tab');
            $('#span-label').removeClass('active-tab').addClass('deactive-tab');
            $('#tab-1').removeClass('visible-tab');
            $('#output').addClass('list').removeClass('span');
            submitValidate();
        });        
        
        
        // разрядность и валидность для count/min/max
        // +++
        $('#count').on('input',function(){
            let countInput=$('#count');
            let val=$(countInput).val();
            let countWrapLeft=$('#count-wrap').position().left;
            let countWrapWidth=$('#count-wrap').width();
            let countWrapParentWidth=$('#initial').width();
            let countNoticeWidth,countNoticeLeft;
            if(winW<480){
                countNoticeWidth=240;
            }else{
                countNoticeWidth=280;
            };
            if((countWrapLeft>=(countNoticeWidth-countWrapWidth)/2)&&(countWrapParentWidth-countWrapLeft-countWrapWidth>(countNoticeWidth-countWrapWidth)/2)){
                countNoticeLeft=-(countNoticeWidth-countWrapWidth)/2;
            }else if((countWrapLeft<countNoticeWidth/2)){
                countNoticeLeft=-countWrapLeft;
            }else{
                countNoticeLeft=-(countNoticeWidth-countWrapParentWidth+countWrapLeft);
            };
            let valInt;
            val=val.replace(/[^0-9]/g,'').replace(/\B(?=(\d{3})+(?!\d))/g,'`');
            val=val.replace(/[^0-9]/g,'');
            val=val.slice(0,4);
            valInt=parseInt(val);
            val=val.replace(/\B(?=(\d{3})+(?!\d))/g,'`');
            if(valInt>1000){
                val=val.replace(/[^0-9]/g,'').slice(0,3);
                $('#count-wrap').append('<div id="count-notice" style="left:'+countNoticeLeft+'px;">Максимальное значение: 1000</div>');
            }else{
                $(document).find('#count-notice').remove();
            };
            $(this).val(val);
        });
        $(document).on('click',function(e){if((!($('#count')).is(e.target))&&(($('#count')).has(e.target).length===0)){$(document).find('#count-notice').remove();if( $('#count').val()==''){$('#count').val(1);};};});
        $('#min,#max').on('input',function(){
            let val=$(this).val();
            val=val.replace(/[^0-9-]/g,'').replace(/(-)(\1)/,'$1').replace(/\B(?=(\d{3})+(?!\d))/g,'`');
            if(val.slice(0,1)=='-'){
                val=val.replace(/[^0-9-]/g,'');
                val=val.slice(0,10);
                val=val.replace(/\B(?=(\d{3})+(?!\d))/g,'`');
                $(this).val(val);
            }else{
                val=val.replace(/[^0-9]/g,'');
                val=val.slice(0,9);
                val=val.replace(/\B(?=(\d{3})+(?!\d))/g,'`');
                $(this).val(val);
            };
            submitValidate();
        });       
        
        
        // исключения + добавление + повторы генерации
        // +++
        $("#repeat,#insert,#discard").prop('checked',false);
        $('label[for="discard"],label[for="insert"]').on('click',function(e){
            e.preventDefault();
            let elemActive=$(this);
            let elemParent=$(elemActive).parent();
            let elemTxt=$(elemParent).find('textarea');
            let elemScrollbar=$(elemParent).find('.txt-up,.txt-down');
            let elemBefore=$(elemActive).prev('.txt-before');
            let elemClasses=$('#output').attr('class');
            let elemAttr=$(elemActive).attr('for');
            let tabHeight=parseInt($('#tab').css('height'));
            let elemMargin=parseInt($(elemParent).css('margin-bottom'));
            let elemMinHeight=20;
            let elemMaxHeight;
            if($('body').is('.mobile')){
                elemMaxHeight=160;
            }else{
                elemMaxHeight=140;
            };
            $(elemActive).toggleClass('active-btn');
            $(elemTxt).toggleClass('element-visible');
            $(elemBefore).toggleClass('element-visible');
            $('#output').toggleClass(elemAttr);
            if($(elemActive).is('.active-btn')){
                $(elemParent).css('height',elemMaxHeight);
                $('#tab').css('height',tabHeight+elemMaxHeight-elemMinHeight);
                $('#'+elemAttr).prop('checked',true);
                if(elemAttr=='insert'){
                    $('label[for="repeat"]').css('transform','translate3d(0,5px,0)');
                };
                if($(elemTxt).is('.txt-scrollbox-visible')){
                    $(elemScrollbar).fadeIn(200);
                };
            }else{
                $(elemParent).css('height',elemMinHeight);
                $('#tab').css('height',tabHeight-elemMaxHeight+elemMinHeight);
                $('#'+elemAttr).prop('checked',false);
                if(elemAttr=='insert'){
                    $('label[for="repeat"]').css('transform','translate3d(0,0,0)');
                };
                if($(elemTxt).is('.txt-scrollbox-visible')){
                    $(elemScrollbar).fadeOut(200);
                };
            };
        });
        $('label[for="repeat"]').on('click',function(e){
            e.preventDefault();
            $('label[for="repeat"]').toggleClass('active-btn');
            $('#output').toggleClass('repeat');
            if($('#repeat').is(':checked')){
                $('#repeat').prop('checked',false);
            }else{
                $('#repeat').prop('checked',true);
            };
        });
        
        
        // валидация минимальных данных
        // +++
        function submitValidate(){
            let minVal=parseInt($('#min').val().replace(/[^0-9-]/g,''));
            let maxVal=parseInt($('#max').val().replace(/[^0-9-]/g,''));
            let appVal=$('#append').val();
            if($('#output').is('.span')){
                if(minVal<maxVal){
                    $('#generate').removeClass('invalid').removeAttr('disabled');
                }else{
                    $('#generate').addClass('invalid').attr('disabled','disabled');
                };
            }else if($('#output').is('.list')){
                if(appVal.length>0){
                    $('#generate').removeClass('invalid').removeAttr('disabled');
                }else{
                    $('#generate').addClass('invalid').attr('disabled','disabled');
                };
            };
        };
        
        
        // отправка формы NUMBER
        // +++
        $('#generate').on('click',function(){
            if(loadLibrary==0){
                let googleStat=document.createElement('script');
                googleStat.src='/assets/googlestatn.min.js';
                document.head.append(googleStat);
                let yandexStat=document.createElement('script');
                yandexStat.src='/assets/yandexstatn.min.js';
                document.head.append(yandexStat);
                submitDelay=1000;
                loadLibrary=1;
            }else{
                submitDelay=100;
            };
        });
        $('#form-number').delay(submitDelay).submit(function(){
            let mobileRider;
            if($('body').is('.mobile')){
                mobileRider=90;
            }else{
                mobileRider=0;
            };            
            let outputMarginTop=parseInt($('#generate-menu').next('.hr').css('margin-top'));
            let outputMarginBottom=20;
            let outputDataMargin=parseInt($('#output-data').css('margin-top'));
            let outputLine=parseInt($('#output-data').css('line-height'));
            let outputHeight,outputRow;
            let values=$('#form-number').serialize();
            let classes=$('#output').attr('class');
            $('#classes').val(classes);
            $.post(
                '/numberGeneration',
                values,
                function(send){
                    $('#output-data').html(send.result);
                    $('#date-time').html(send.time);
                    outputHeight=$('#output-data').height();
                    outputRow=outputHeight/outputLine;
                    scrollSpeed=(.2+12*outputRow/1000).toFixed(3);
                    if(localStorage.getItem('manual')=='removed'){
                        if(outputOpen==0){
                            setTimeout(function(){
                                $('html,body').animate({scrollTop:dashboardTop-100},1000*scrollSpeed);
                            },200);
                            setTimeout(function(){
                                funcManual();
                            },1000*scrollSpeed+100);
                            setTimeout(function(){
                                $('#output').css({transform:'scale3d(1,1,1)',height:(outputHeight+2*outputMarginTop+outputDataMargin-mobileRider)+'px',marginBottom:outputMarginBottom+'px',transition:'height '+scrollSpeed+'s, margin '+scrollSpeed/2+'s'});
                                outputOpen=1;
                            },1000*scrollSpeed+400);
                        }else{
                            setTimeout(function(){
                                $('html,body').animate({scrollTop:dashboardTop-100},1000*scrollSpeed);
                            },200);
                            setTimeout(function(){
                                funcManual();
                            },1000*scrollSpeed+100);
                            setTimeout(function(){
                                $('#output').css({transform:'scale3d(1,1,1)',height:(outputHeight+2*outputMarginTop+outputDataMargin-mobileRider)+'px',marginBottom:outputMarginBottom+'px',transition:'height '+scrollSpeed+'s, margin '+scrollSpeed/2+'s'});
                            },1000*scrollSpeed+400);
                        };
                    }else{
                        if(outputOpen==0){
                            setTimeout(function(){
                                $('html,body').animate({scrollTop:dashboardTop-funcManualHeight-100},1000*scrollSpeed);
                            },200);
                            setTimeout(function(){
                                funcManual();
                            },1000*scrollSpeed+100);
                            setTimeout(function(){
                                $('#output').css({transform:'scale3d(1,1,1)',height:(outputHeight+2*outputMarginTop+outputDataMargin-mobileRider)+'px',marginBottom:outputMarginBottom+'px',transition:'height '+scrollSpeed+'s, margin '+scrollSpeed/2+'s'});
                                disableScroll();
                                outputOpen=1;
                            },1000*scrollSpeed+400);
                        }else{
                            setTimeout(function(){
                                $('html,body').animate({scrollTop:dashboardTop-funcManualHeight-100},1000*scrollSpeed);
                            },200);
                            setTimeout(function(){
                                funcManual();
                            },1000*scrollSpeed+100);
                            setTimeout(function(){
                                $('#output').css({transform:'scale3d(1,1,1)',height:(outputHeight+2*outputMarginTop+outputDataMargin-mobileRider)+'px',marginBottom:outputMarginBottom+'px',transition:'height '+scrollSpeed+'s, margin '+scrollSpeed/2+'s'});
                                disableScroll();
                            },1000*scrollSpeed+400);
                        };
                    };
                },
                'json'
            );
            return false;
        });
        
        
        // manual по сохранению+копированию+печати+екселю+скрину
        // +++
        function funcManual(){
            if(localStorage.getItem('manual')=='removed'){}else{
                setTimeout(function(){
                    $('#func-manual').css('transform','translate3d(0,-100%,0) scale3d(1,1,1)');
                    $('#generate-menu').addClass('allot-menu');
                },300);
            };
        };
        $(document).on('click','#close-manual',function(){
            localStorage.setItem('manual','removed');
            $('#func-manual').css('transform','translate3d(0,-100%,0) scale3d(1,0,1)');
            $('#generate-menu').removeClass('allot-menu');
            enableScroll();
            setTimeout(function(){
                reviewSend();
            },10000);
            // как состыковать с тем, что не запущены какие иные функции ???....
        });
        
        
        // перемешивание результата генерации
        // +++
        $('#shuffle-generate').on('click',function(){
            let outShuffleString=$('#output-data').text().split(' ').sort(function(){return Math.random()>.5?1:-1;}).join(' ');
            $('#output-data').empty().append(outShuffleString);
        });
        
        
        // скопировать результат генерации
        // +++
        $('#copy-generate').on('click',function(){
            let $tmp=$('<textarea>');
            $('body').append($tmp);
            $tmp.val($('#output-data').text()).select();
            document.execCommand('copy');
            $('#copy-generate').append('<span id="copy-notice"></span>');
            $('#copy-generate').hover(function(){},function(){
                $('#copy-generate').find('#copy-notice').remove();
            });
            $tmp.remove();
        });
        
        
        // конвертация + сохранение + печать
        // +++
        function screenResult(){
            let timeText=$('#date-time').text();
            let generationText=$('#output-data').text();
            let countText=$('#count').val();
            let fromText=$('#min').val();
            let toText=$('#max').val();
            let listText=$('#append').val();
            let discardText,insertText,repeatText;
            if($('#output').is('.discard')){
                discardText=$('#discard-txt').val();
            }else{
                discardText='';
            };
            if($('#output').is('.insert')){
                insertText=$('#insert-txt').val();
            }else{
                insertText='';
            };
            if($('#output').is('.repeat')){
                repeatText='Повторы исключены.';
            }else{
                repeatText='Возможны повторы.';
            };
            let context;
            if(screenBtn=='save'){
                context='Подготовка сохранения...';
            }else if(screenBtn=='excel'){
                context='Подготовка конвертации...';
            }else if(screenBtn=='print'){
                context='Подготовка печати...';
            };
            let screenParam=''+timeText+','+generationText+','+countText+','+fromText+','+toText+','+listText+','+discardText+','+insertText+','+repeatText+'';
            getMainDate();
            if(!$('body').is('.mobile')){
                $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(50px,0,0)');
                $('#logo').fadeOut(200);
            }else{
                $('#panel').addClass('panel-close');
            };
            $('#notice-content').append('<span>'+context+'</span><div id="indicator"><div id="indicator-color"></div></div>');
            setTimeout(function(){
                $('main,aside,footer').css('transform','scale3d(0,1,1)');
                $('#notice,#background').css('transform','scale3d(1,1,1)');
            },200);
            setTimeout(function(){
                $('#notice-content').addClass('save-content');
            },500);
            /*
            if(screenBtn=='save'){
                setTimeout(async function(){
                    $('body').addClass('screening saveds');
                    if($('#output').is('.span')){
                        $('body').append('<style class="res-style">#res-list{display:none;}</style>');
                    }else{
                        $('body').append('<style class="res-style">#res-span{display:none;}</style>');
                    };
                    await fetch('/numberImage',{
                        method:'POST',
                        body:screenParam
                    })
                    .then((response)=>response.json())
                    .then((data)=>{
                        let dD1=data['1'];
                        let dD2=data['2'];
                        return window['\x72\x44\x4e'](dD1)
                        .then(()=>{
                            window['\x63\x44\x4e'](dD2);
                            setTimeout(function(){
                                $('#notice,#background').css('transform','scale3d(0,1,1)');
                                $('main,aside,footer').css('transform','scale3d(1,1,1)');
                                cCN();
                                $('#output').append('<div id="display">Секундочку, сохраняю<div id="track"><span></span><span></span><span></span><span></span><span></span><span></span></div></div>');
                                exiting();
                            },2300);
                        });
                    })
                    .catch(()=>{
                        functionError();
                    })
                },510);
            }else if(screenBtn=='excel'){
                setTimeout(function(){
                    $('body').addClass('screening');
                    if($('#output').is('.span')){
                        $('body').append('<style class="res-style">#res-list{display:none;}</style>');
                    }else{
                        $('body').append('<style class="res-style">#res-span{display:none;}</style>');
                    };
                    fetch('/numberExcel',{
                        method:'POST',
                        body:screenParam
                    })
                    .then((response)=>response.json())
                    .then((data)=>{
                        let dD1=data['1'];
                        let dD2=data['2'];
                        return window['\x72\x44\x4e'](dD1)
                        .then(()=>{
                            window['\x65\x44\x4e'](dD2);
                            eCN();
                        })
                        .catch(()=>{
                            functionError();
                        })
                    })
                },600);
                setTimeout(function(){
                    $('#notice,#background').css('transform','scale3d(0,1,1)');
                    $('main,aside,footer').css('transform','scale3d(1,1,1)');
                    exiting();
                    enableScroll();
                },2800);
            }else if(screenBtn=='print'){
                setTimeout(function(){
                    $('body').addClass('screening');
                    if($('#output').is('.span')){
                        $('body').append('<style class="res-style">#res-list{display:none;}</style>');
                    }else{
                        $('body').append('<style class="res-style">#res-span{display:none;}</style>');
                    };
                    fetch('/numberPrint',{
                        method:'POST',
                        body:screenParam
                    })
                    .then((response)=>response.json())
                    .then((data)=>{
                        let dD1=data['1'];
                        let dD2=data['2'];
                        return window['\x72\x44\x4e'](dD1)
                        .then(()=>{
                            window['\x70\x44\x4e'](dD2);
                            $('#notice,#background').css('transform','scale3d(0,1,1)');
                            $('main,aside,footer').css('transform','scale3d(1,1,1)');
                            pCN();
                            exiting();
                            enableScroll();
                        });
                    })
                    .catch(()=>{
                        functionError();
                    })
                },2800);
            };*/
        };
        
        
        // проверка визуала и функционала в мобильном варианте
        // +++
        function exiting(){
            if(!$('body').is('.mobile')){
                $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(0,0,0)');
                $('#logo').fadeIn(200);
            }else{
                $('#panel').removeClass('panel-close');
            };
            $('#notice-content').removeClass('save-content').empty();
            screenBtn='';
            $('body').find('.res-style').remove();
            if($('body').is('.saveds')){
                $('body').removeClass('saveds');
            };
        };
        function functionError(){
            $('#error').append('<div id="error-in"><div id="error-content"><div>Не&shy;из&shy;вест&shy;ная ошиб&shy;ка со&shy;е&shy;ди&shy;не&shy;ния</div><p>По&shy;жа&shy;луй&shy;ста, про&shy;верь&shy;те под&shy;клю&shy;че&shy;ние к ин&shy;тер&shy;не&shy;ту, об&shy;но&shy;ви&shy;те стра&shy;ни&shy;цу и скон&shy;вер&shy;ти&shy;руй&shy;те еще раз.</p><button id="convert-reload">Обновить страницу</button></div></div>').css('display','block');
            setTimeout(function(){
                 $('#error').css('transform','scale3d(1,1,1)');
            },10);
        };
        
        
        // перезагрузка при ошибке
        // +++
        $(document).on('click','#convert-reload',function(){
            $('#reload').css('display','block').addClass('exit-page');
            setTimeout(function(){
                window.location.reload();
            },timeOut);
        });
        
        
        // сохранение в excel
        // +++
        $('#save-xls').click(function(e){e.preventDefault();disableScroll();screenBtn='excel';screenResult();});
        
        
        // сохранение скрина генерации
        // +++
        $('#save-generate').on('click',function(e){functionError();
                                                   //setTimeout(function(){e.preventDefault();disableScroll();screenBtn='save';screenResult();},200);
                                                  });
        
        
        // ссылка на генерацию
        // +++
        $('#link-generate').on('click',function(e){
            e.preventDefault();
            disableScroll();
            $('.parse-data').each(function(){
                let parseText=$(this).val();
                let submitParseText=parseText.replace(/[^\d]+/gm,' ').replace(/^\s+|\s+$/g,'');
                if($(this).is('textarea')){
                    $(this).text(submitParseText);
                }else if($(this).is('input')){
                    $(this).attr('value',submitParseText);
                };
            }); 
            let file_data=$('main').html(); 
            let form_data=new FormData();    
            let links=linkUrl(10);
            let nameData=$('#date-time').text();
            form_data.append('file',file_data);
            form_data.append('links',links);
            $.ajax({
                url:'/savePage', 
                dataType:'html',
                cache:false,
                contentType:false,
                processData:false,
                data:form_data,   
                method:'POST'
            });
            if(!$('body').is('.mobile')){
                $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(50px,0,0)');
                $('#logo').fadeOut(200);
            }else{
                $('#panel').addClass('panel-close');
            };
            $('#notice').append('<div id="notice-content" class="link-content"><p><a href="https://randomm.ru/saved/'+links+'.html" target="_blank">Пер&shy;со&shy;наль&shy;ная ссыл&shy;ка на ре&shy;зуль&shy;тат ва&shy;шей ге&shy;не&shy;ра&shy;ции от '+nameData+'</a> соз&shy;да&shy;на и ус&shy;пеш&shy;но сох&shy;ра&shy;не&shy;на. Она дос&shy;туп&shy;на в те&shy;че&shy;ние 24 ча&shy;сов, пос&shy;ле че&shy;го бу&shy;дет ав&shy;то&shy;ма&shy;ти&shy;чес&shy;ки уда&shy;ле&shy;на без воз&shy;мож&shy;нос&shy;ти вос&shy;ста&shy;нов&shy;ле&shy;ния.</p><button title="Закрыть окно уведомления" id="link-close"></button></div');
            setTimeout(function(){
                $('main,aside,footer').css('transform','scale3d(0,1,1)');
                $('#notice,#background').css('transform','scale3d(1,1,1)');
                $('#link-close').addClass('close-visible');
            },200);
            setTimeout(function(){
                $('.link-content').find('#link-close').css('transform','scale3d(1,1,1) rotate(0)').removeClass('close-visible');
            },1200);
        });
        function linkUrl(counting){component='123456789';let linkUrlString='';for(let i=0;i<counting;i++){let pos=Math.floor(Math.random()*component.length);linkUrlString+=component.substring(pos,pos+1);};return linkUrlString;};
        $(document).on('click','#link-close',function(){
            $('#link-close').addClass('close-hidden');
            setTimeout(function(){
                $('#notice,#background').css('transform','scale3d(0,1,1)');
                $('main,aside,footer').css('transform','scale3d(1,1,1)');
            },300);
            setTimeout(function(){
                if(!$('body').is('.mobile')){
                    $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(0,0,0)');
                    $('#logo').fadeIn(200);
                }else{
                    $('#panel').removeClass('panel-close');
                };
                $('#notice').empty();
                $('#link-close').css('transform','scale3d(0,0,1) rotate(0)').removeClass('close-hidden');
                enableScroll();
            },600);
        });
      
        
        // печать генерации
        // +++
        $('#print-generate').on('click',function(e){e.preventDefault();disableScroll();screenBtn='print';screenResult();});

        
        // скроллинг textarea
        // +++
        /*
        $('#append,#discard-txt,#insert-txt').on('input',function(){
            let textarea=$(this);
            let textareaId=$(textarea).attr('id');
            let textareaContent=$(textarea).val();
            $(textarea).val(textareaContent.replace(/[^0-9' '-]/g,'').replace(/(-)\1{1}/,'').replace(/\n/g,' '));
            let textareaHeight=parseInt($(textarea).css('height'));
            if(textareaId=='append'){
                textareaContentHeight=appendContentHeight;
            }else if(textareaId=='discard-txt'){
                textareaContentHeight=discardContentHeight;
            }else if(textareaId=='insert-txt'){
                textareaContentHeight=insertContentHeight;
            };
            $('body').find('#calculation').text(textareaContent);
            let textareaBorderHeight=parseInt($('body').find('#calculation').height());
            if((textareaBorderHeight>textareaHeight)||(textareaContentHeight>textareaHeight)){
                $(textarea).addClass('txt-scrollbox-visible').parent().find('.txt-up,.txt-down').fadeIn(200);
                if($(textarea).is('#append')){
                    $(textarea).addClass('txt-scrollbox-visible').parent().find('.txt-up,.txt-down,.txt-before').fadeIn(200);
                };
            }else{
                $(textarea).removeClass('txt-scrollbox-visible').parent().find('.txt-up,.txt-down').fadeOut(200);
                if($(textarea).is('#append')){
                    $(textarea).removeClass('txt-scrollbox-visible').parent().find('.txt-up,.txt-down,.txt-before').fadeOut(200);
                };
            };
            if(textareaId=='append'){
                appendContentHeight=textareaBorderHeight;
                submitValidate();
            }else if(textareaId=='discard-txt'){
                discardContentHeight=textareaBorderHeight;
            }else if(textareaId=='insert-txt'){
                insertContentHeight=textareaBorderHeight;
            };
        });
        $('#append,#discard-txt,#insert-txt').on('focus',function(){
            let textareaContent=$(this).val();
            let textareaPadding=parseInt($(this).css('padding-right'));
            let textareaWidth=parseInt($(this).css('width'))-textareaPadding;
            let textareaHeight=parseInt($(this).css('height'));
            let textareaLineHeight=parseInt($(this).css('line-height'));
            let textareaFontSize=parseInt($(this).css('font-size'));
            let textareaFont=$(this).css('font-family');
            let textareaSpacing=parseInt($(this).css('word-spacing'));
            $('body').append('<div id="calculation" style="position:fixed;top:0;left:0;width:'+textareaWidth+'px;line-height:'+textareaLineHeight+'px;margin:0;padding:0;font-family:'+textareaFont+';font-size:'+textareaFontSize+'px;text-align:justify;word-spacing:'+textareaSpacing+'px;visibility:hidden;z-index:-5;"></div>');
        });
        $('#append,#discard-txt,#insert-txt').on('blur',function(){
            textareaContentHeight=0;
            $('body').find('#calculation').remove();
        });
        $('.txt-up,.txt-down').on('click',function(e){
            e.preventDefault();
            let currentBtn=$(this);
            let currentArea=$(currentBtn).parent().find('textarea');
            let currentAreaId=$(currentArea).attr('id');
            if(currentAreaId=='append'){
                contentHeight=appendContentHeight;
            }else if(currentAreaId=='discard-txt'){
                contentHeight=discardContentHeight;
            }else if(currentAreaId=='insert-txt'){
                contentHeight=insertContentHeight;
            };
            let deltaScroll=parseInt($(currentArea).css('line-height'));
            let areaHeight=parseInt($(currentArea).css('height'));
            if(currentBtn.is('.txt-up')){
                if(startScroll>deltaScroll){
                    startScroll-=deltaScroll;
                }else{
                    startScroll=0;
                };
            }else if(currentBtn.is('.txt-down')){
                if(startScroll<contentHeight-areaHeight-deltaScroll){
                    startScroll+=deltaScroll;
                }else{
                    startScroll=contentHeight-areaHeight;
                };
            };
            $(currentArea).animate({scrollTop:startScroll},200);
        });
        */
        
        
        // внутренние и внешние ссылки
        // +++
        $('a').on('click',function(e){
            e.preventDefault();
            let link=$(this);
            let linkHref=$(link).attr('href');
            let linkTarget=$(link).attr('target');
            if(linkTarget=='_blank'){
                window.open(linkHref,'_blank');
            }else{
                if(linkHref==currentURL){
                }else{
                    $('#nav-close').addClass('close-hidden');
                    setTimeout(function(){
                        $('nav,#background').css('transform','scale3d(0,1,1)');
                        $('main,aside,footer').css('transform','scale3d(1,1,1)');
                    },300);
                    setTimeout(function(){
                        $('#reload').css('display','block').addClass('exit-page');
                    },600);   
                    setTimeout(function(){
                        window.location.href='https://randomm.ru'+linkHref;
                    },1500);
                };
            };
        });
        
        
        // вывод формы рейта
        // -
        // привязка к закрытию мануала с учетом флага
        function reviewSend(){
            disableScroll();
            $('#review').css('display','block');
            $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(50px,0,0)');
            if($('body').is('.mobile')){
                $('#panel').addClass('panel-close');
            }else{
                $('#logo').fadeOut(200);
            };
            setTimeout(function(){
                $('#notice,#background').css('transform','scale3d(1,1,1)');
                $('main,aside,footer').css('transform','scale3d(0,1,1)');
                $('#review-close').addClass('close-visible');
            },200);
            setTimeout(function(){
                $('#review-close').css('transform','scale3d(1,1,1) rotate(0)').removeClass('close-visible');
            },1200);
        };
        function reviewClose(){
            $('#review-close').addClass('close-hidden');
            setTimeout(function(){
                $('#notice,#background').css('transform','scale3d(0,1,1)');
                $('main,aside,footer').css('transform','scale3d(1,1,1)');
                if($('body').is('.mobile')){
                    $('#header').addClass('header-hidden');
                };
            },300);
            setTimeout(function(){
                if($('body').is('.mobile')){
                    $('#panel').removeClass('panel-close');
                }else{
                    $('#logo').fadeIn(200);
                };
                $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(0,0,0)');
                $('#review').css('display','none');
                $('#review-close').css('transform','scale3d(0,0,1) rotate(0)').removeClass('close-hidden');
                enableScroll();
            },600);
        };
        $('#review-close').on('click',function(){
            reviewClose();
        });
        $('#high,#low').on('click',function(){
            if($(this).is('#high')){
                $('#review-message').val('+');
            }else if($(this).is('#low')){
                $('#review-message').val('-');
            };
            let reviewValue=$('#review-message').val();
            if((reviewValue=='+')||(reviewValue=='-')){
                $.post('/numberReview',$('#number-review').serialize(),function(data){
                $('#perfect').html(data.positive);
                $('#bad').html(data.negative);
                $('#number-review').css('opacity',0);
                $('#review-thanks').css('opacity',1);
                setTimeout(function(){
                    reviewClose();
                },2000);
                }, "json");
                return false;
            }else{
                return false;
            };
        });
        
        
        // feedback
        // -
        // ввод текста
        // в #func-manual сделать флагом + поставить такие флаги во все функции + setInterval
        // разнести оформление по темам
        $('#feedback-open').on('click',function(){
            disableScroll();
            $('#feedback').css('display','block');
            $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(50px,0,0)');
            if($('body').is('.mobile')){
                $('#panel').addClass('panel-close');
            }else{
                $('#logo').fadeOut(200);
            };
            setTimeout(function(){
                $('#notice,#background').css('transform','scale3d(1,1,1)');
                $('main,aside,footer').css('transform','scale3d(0,1,1)');
                $('#feedback-close').addClass('close-visible');
            },200);
            setTimeout(function(){
                $('#feedback-close').css('transform','scale3d(1,1,1) rotate(0)').removeClass('close-visible');
            },1200);
        });
        $('#feedback-bot').on('click',function(e){
            e.preventDefault();
            if($('#feedback-submit').is('.invalid')){
                $('#feedback-bot').addClass('feedback-checked');
                $('#feedback-form').addClass('form-successful');
                $('#feedback-submit').removeClass('invalid').addClass('submit-successful').removeAttr('disabled');
            }else{
                $('#feedback-bot').removeClass('feedback-checked');
                $('#feedback-form').removeClass('form-successful');
                $('#feedback-submit').addClass('invalid').removeClass('submit-successful').attr('disabled','disabled');
            };
        });
        $(document).on('input','#feedback-message,#feedback-email',e=>{
            let messageLength=$('#feedback-message').val().length;
            let emailValue=$('#feedback-email').val();
            let emailLength=$('#feedback-email').val().length;
            let emailPattern=/^[a-z0-9_-]+@[a-z0-9-]+\.[a-z]{2,6}$/i;
            if(messageLength>30){$('#feedback-message').addClass('feedback-validate');}else{$('#feedback-message').removeClass('feedback-validate');};
            if((emailLength>6)&&(emailPattern.test(emailValue))){$('#feedback-email').addClass('feedback-validate');}else{$('#feedback-email').removeClass('feedback-validate');};
            if($('.feedback-validate').length==2){
                $('#feedback-form').addClass('form-validate');
                $('#feedback-bot,#feedback-submit').addClass('feedback-visible');
            }else{
                $('#feedback-form').removeClass('form-validate');
                $('#feedback-bot').removeClass('feedback-checked feedback-visible');
                $('#feedback-submit').attr('disabled','disabled').removeClass('submit-successful feedback-visible').addClass('invalid');
            };
        });
        
        $('#feedback-submit').on('click',function(e){
            e.preventDefault();
            let feedbackMessage=$('#feedback-message').val();
            feedbackMessage=feedbackMessage.replace(/["'`=]/g,'');
            $('#feedback-message').val(feedbackMessage);
            if(($('#feedback-form').is('.form-validate'))&&($('#feedback-form').is('.form-successful'))&&($('#feedback-submit').is('.submit-successful'))){
                let form_data=$('#feedback-form').serialize();
                $.ajax({
                    type:'POST',url:'/feedback',data:form_data,success:function(){
                        $('#feedback-form').css('opacity',0);
                        $('#feedback-send').css('opacity',1);
                        setTimeout(function(){
                            $('#feedback-form').css('visibility','hidden');
                        },300);
                        setTimeout(function(){
                            feedbackClose();
                        },500000000);
                    }
                });
            }else{
                return false;
            };
        });
        function feedbackClose(){
            $('#feedback-close').addClass('close-hidden');
            setTimeout(function(){
                $('#notice,#background').css('transform','scale3d(0,1,1)');
                $('main,aside,footer').css('transform','scale3d(1,1,1)');
                if($('body').is('.mobile')){
                    $('#header').addClass('header-hidden');
                };
            },300);
            setTimeout(function(){
                if($('body').is('.mobile')){
                    $('#panel').removeClass('panel-close');
                }else{
                    $('#logo').fadeIn(200);
                };
                $('#logo,#nav-open,#social-open,#setting-open,summary,#header-bg').css('transform','translate3d(0,0,0)');
                $('#feedback').css('display','none');
                $('#feedback-form').css({opacity:1,visibility:'visible'}).removeClass('form-validate form-successful');
                $('#feedback-message').removeClass('feedback-validate');
                $('#feedback-email').removeClass('feedback-validate');
                $('#feedback-bot').removeClass('feedback-visible feedback-checked');
                $('#feedback-submit').removeClass('feedback-visible submit-successful').addClass('invalid').attr('disabled','disabled');
                $('#feedback-send').css('opacity',0);
                $('#feedback-form')[0].reset();
                $('#feedback-close').css('transform','scale3d(0,0,1) rotate(0)').removeClass('close-hidden');
                enableScroll();
            },600);
        };
        $('#feedback-close').on('click',function(){
            feedbackClose();
        });
        
        
        // scroll
        // +++
        $(window).scroll(function(){
            var scrollTopY=$(this).scrollTop();
            if($('body').is('.mobile')){
                if(!$('#header').is('.header-hidden')){
                    $('#header').addClass('header-hidden');
                    $('#blured').fadeOut(200);
                    setTimeout(function(){
                        $('#panel').removeClass('panel-close');
                    },200);
                };
            }else{
                if(scrollPos>5){$('#logo').addClass('smally-vision').removeClass('fully-vision');}else{$('#logo').addClass('fully-vision').removeClass('smally-vision');}; 
            };
            scrollPos=scrollTopY;
            return false;
        });


        
        
        
        

    });
    
    
})(jQuery);